<html>
<head>
  <title>ulf</title>
  <style>
    body{margin:0;}
    canvas{ width:100%; height: 100%;}
    #data{color: white; position: absolute;}
  </style>
</head>
<body>
  <p id="data">
    Vx: <span id="vx"></span><br>
    Vy: <span id="vy"></span><br>
    Vz: <span id="vz"></span><br>
    <br>
    x: <span id="px"></span><br>
    y: <span id="py"></span><br>
    z: <span id="pz"></span><br>
    <br>
    rot x: <span id="rotx"></span><br>
    rot y: <span id="roty"></span><br>
    rot z: <span id="rotz"></span><br>
    <br>
    thrust: <span id="thrust"></span><br>
    <br>
    torqueX: <span id="torqueX"></span><br>
    torqueY: <span id="torqueY"></span><br>
    torqueZ: <span id="torqueZ"></span><br>
    <br>
    Desired height: <span id="desH"></span><br>
    Desired pitch: <span id="desP"></span><br>
    Desired yaw: <span id="desY"></span><br>
    Desired roll: <span id="desR"></span><br>
  </p>
  <script src="https://ajax.googleapis.com/ajax/libs/threejs/r69/three.min.js"></script>
  <script src="http://cdnjs.cloudflare.com/ajax/libs/mathjs/1.2.0/math.min.js"></script>
  <script src="scripts/mathFunctions.js"></script>
  <script src="scripts/geometry.js"></script>
  <script src="scripts/constants.js"></script>
  <script src="scripts/copterVariables.js"></script>
  <script src="scripts/thrustPD.js"></script>
  <script src="scripts/positionCalculation.js"></script>
  <script src="scripts/flightControl.js"></script>
  <script>
    var scene = new THREE.Scene();
    var camera = new THREE.PerspectiveCamera( 75, window.innerWidth/window.innerHeight, 0.1, 1000 );

    var renderer = new THREE.WebGLRenderer();
    renderer.setSize( window.innerWidth, window.innerHeight );
    document.body.appendChild( renderer.domElement );

    scene.add(copter);

    // camera.up.set( 0, 0, 1 );
    camera.position.x -= 5;
    camera.position.z = 5;
    camera.up.set( 0, 0, 1 );
    camera.lookAt(new THREE.Vector3(0,0,0));
    var clock =  new THREE.Clock(),
        controls = flightControl(),
        rotorAngV;

    copter.position.y = positionInertial._data[1][0];

    var render = function () {
      delta = clock.getDelta();
      setTimeout(function() {requestAnimationFrame( render );}, 1000/30);

      // Update velocities and rotations
      controls.update(0.01);

      //Use this late, FIXME
      rotorAngularVelocity = math.matrix([[Math.sqrt(controls.rotors.r1)],
                               [Math.sqrt(controls.rotors.r2)],
                               [Math.sqrt(controls.rotors.r3)],
                               [Math.sqrt(controls.rotors.r4)]]);
      var pos = newPos(0.01);


      copter.position.x = (pos[0]);
      copter.position.y = (pos[1]);
      copter.position.z = (pos[2]);

      //copter.quaternion.
      //angles = new THREE.Euler( pos[3], pos[4], pos[5], 'XYZ' );
      // copter.rotation.x = pos[3];
      // copter.rotation.y = pos[4];
      // copter.rotation.z = pos[5];
      copter.rotateOnAxis(new THREE.Vector3( 0, 0, 1 ), pos[5]);
      copter.rotateOnAxis(new THREE.Vector3( 0, 1, 0 ), pos[4]);
      copter.rotateOnAxis(new THREE.Vector3( 1, 0, 0 ), pos[3]);


      //if(copter.position.y <= 0)
      //  copter.position.y = 2;

      // Display velocities on screen
      document.getElementById('vx').innerHTML = pos[10];
      document.getElementById('vy').innerHTML = pos[11];
      document.getElementById('vz').innerHTML = pos[12];

      document.getElementById('px').innerHTML = copter.position.x;
      document.getElementById('py').innerHTML = copter.position.y;
      document.getElementById('pz').innerHTML = copter.position.z;

      document.getElementById('rotx').innerHTML = pos[3] * 57.296; // <-- 180/pi
      document.getElementById('roty').innerHTML = pos[4] * 57.296; // <-- 180/pi
      document.getElementById('rotz').innerHTML = pos[5] * 57.296; // <-- 180/pi

      document.getElementById('thrust').innerHTML = pos[6];

      document.getElementById('torqueX').innerHTML = pos[7];
      document.getElementById('torqueY').innerHTML = pos[8];
      document.getElementById('torqueZ').innerHTML = pos[9];

      document.getElementById('desH').innerHTML = posMat._data[2][0];
      document.getElementById('desP').innerHTML = angMat._data[1][0];
      document.getElementById('desY').innerHTML = angMat._data[2][0];
      document.getElementById('desR').innerHTML = angMat._data[0][0];

      renderer.render(scene, camera);
    };

    render();

    </script>
</body>
</html>
