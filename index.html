<html>
<head>
  <title>ulf</title>
  <style>
    body{margin:0;}
    canvas{ width:100%; height: 100%;}
    #data{color: white; position: absolute;}
  </style>
</head>
<body>
  <p id="data">
    Vx: <span id="vx"></span><br>
    Vy: <span id="vy"></span><br>
    Vz: <span id="vz"></span><br>
    <br>
    x: <span id="px"></span><br>
    y: <span id="py"></span><br>
    z: <span id="pz"></span><br>
  </p>
  <script src="https://ajax.googleapis.com/ajax/libs/threejs/r69/three.min.js"></script>
  <script src="scripts/flightControl.js"></script>
  <script src="scripts/geometry.js"></script>
  <script>
      var scene = new THREE.Scene();
      var camera = new THREE.PerspectiveCamera( 75, window.innerWidth/window.innerHeight, 0.1, 1000 );

      var renderer = new THREE.WebGLRenderer();
      renderer.setSize( window.innerWidth, window.innerHeight );
      document.body.appendChild( renderer.domElement );

      scene.add(copter);

      camera.position.z = 5;
      camera.position.y = 2;
      var clock =  new THREE.Clock(),
          controls = flightControl();


      var render = function () {
        delta = clock.getDelta()/4;
        requestAnimationFrame( render );

        if(controls.x.neg){
          controls.velocities.x -= delta;
        }if(controls.x.pos){
          controls.velocities.x += delta;
        }if(!controls.x.pos && !controls.x.neg){
          controls.velocities.decrease(delta, 'x');
        }if(controls.y.neg){
          controls.velocities.y -= delta;
        }if(controls.y.pos){
          controls.velocities.y += delta;
        }if(!controls.y.pos && !controls.y.neg){
          controls.velocities.decrease(delta, 'y');
        }if(controls.z.neg){
          controls.velocities.z -= delta;
        }if(controls.z.pos){
          controls.velocities.z += delta;
        }if(!controls.z.pos && !controls.z.neg){
          controls.velocities.decrease(delta, 'z');
        }if(controls.yaw.neg){
          copter.rotation.y -= 8*delta;
        }if(controls.yaw.pos){
          copter.rotation.y += 8*delta;
        }

        // Apply transformations
        copter.translateX(controls.velocities.x);
        copter.translateZ(controls.velocities.z);

        if(controls.velocities.y + copter.position.y < 0)
          copter.position.y = 0;
        else
          copter.translateY(controls.velocities.y);

        for (var i = 0; i < 4; i++) {
          rotors[i].rotation.y += 10*(Math.cos(controls.velocities.z) + Math.cos(controls.velocities.y) + Math.cos(controls.velocities.x));
        };
        copter.rotation.z = -controls.velocities.x;
        copter.rotation.x = controls.velocities.z;


        // Display velocities on screen
        document.getElementById('vx').innerHTML = controls.velocities.x;
        document.getElementById('vy').innerHTML = controls.velocities.y;
        document.getElementById('vz').innerHTML = controls.velocities.z;

        document.getElementById('px').innerHTML = copter.position.x;
        document.getElementById('py').innerHTML = copter.position.y;
        document.getElementById('pz').innerHTML = copter.position.z;

        renderer.render(scene, camera);
      };

      render();

    </script>
</body>
</html>
